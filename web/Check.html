
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de" lang="de">

<head>
    <title>CheckWaitingSlice</title>

    <link href="css/styles.css" rel="stylesheet" type="text/css" media="screen"/>
    <link href="css/print.css" rel="stylesheet" type="text/css" media="print"/>
    <link href="css/bootstrap.css" rel="stylesheet" media="screen"/>
    <link href="css/floatMenu.css" rel="stylesheet"/>
    <link rel="stylesheet" href="css/demo.css"/>

</head>
<body>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" id="m">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Show Topology</h4>
            </div>
            <div class="modal-body">
                <div id="modelType">
                    <div class="demo flowchart-demo" id="flowchart-demo">
                    </div>
                </div>


            </div>
            <div class="modal-footer">

                <button type="button" class="btn btn-default" data-dismiss="modal"  >Close</button>

            </div>
        </div>
    </div>
</div>
<div id="wrapper">
    <!-- start header -->
    <div id="header">
        <div class="header-content">
            <div class="topnavbar clearfix">
                <span class="alignright">
                    <a class="padding-left" href="index.html" title="Logout" ><?php echo $_COOKIE["username"];?></a>
                    <a class="padding-left" href="index.html" title="Logout" onclick="delCookie('authToken')">Logout</a>
                </span>
            </div>
        </div>


    </div>
        <!-- start content -->
        <div id="container2" class="clearfix">
            <div class="content">
                <div class="col1-4">

                    <div id="floatMenu">

                        <ul class="nav nav-pills nav-stacked text-center">

                            <li >
                                <a class="first"  href="Create.html">CREATE</a>
                            </li>
                            <li class="active"><a>CHECK</a>
                            <ul class="nav nav-pills nav-stacked ">
                                <li><a  class="second"  href="#WaitingSlice">Waiting Slice</a></li>
                                <li><a  class="second"  href="#RunningSlice">Running Slice</a></li>
                            </ul>
                            </li>
                            <li><a class="first" href="#">UPDATE</a></li>
                        </ul>
                    </div>
                </div>


                <div class="col3-4 last">
                    <div class="context">
                        <br/>
                        <div id="WaitingSlice">

                              <h2>Waiting Slice</h2>
                            <table class="table table-hover">

                                <thead>
                                <tr >
                                    <th>
                                        SliceID
                                    </th>
                                    <th>
                                        StartTime
                                    </th>
                                    <th>
                                        EndTime
                                    </th>
                                    <th>
                                        # of Switch
                                    </th>
                                    <th>
                                        # of VM
                                    </th>
                                    <th>
                                        IP
                                    </th>
                                    <th>
                                        Port
                                    </th>
                                    <th>
                                        More
                                    </th>
                                    <th>
                                        Delete
                                    </th>
                                </tr>




                                </thead>
                                <tbody id="CheckWaitingTbody">

                                </tbody>
                            </table>
                        </div>
                        <div id="RunningSlice">

                            <h2>Running Slice</h2>
                            <table class="table table-hover">

                                <thead>
                                <tr >
                                    <th>
                                        SliceID
                                    </th>
                                    <th>
                                        StartTime
                                    </th>
                                    <th>
                                        EndTime
                                    </th>
                                    <th>
                                         SwitchMap
                                    </th>
                                    <th>
                                        VMMap
                                    </th>
                                    <th>
                                        IP
                                    </th>
                                    <th>
                                        Port
                                    </th>
                                    <th>
                                        Topology
                                    </th>
                                    <th>
                                        Delete
                                    </th>
                                </tr>




                                </thead>
                                <tbody id="CheckRunningTbody">

                                </tbody>
                            </table>
                        </div>

                    </div>



                </div>



            </div>
        </div>
    </div>



<script src="js/jquery-2.1.3.js" type="text/javascript"></script>
<script src="js/bootstrap.js"></script>
<script src="lib/jsBezier-0.6.js"></script>
<!-- event adapter -->
<script src="lib/mottle-0.5.js"></script>
<!-- geometry functions -->
<script src="lib/biltong-0.2.js"></script>
<!-- drag -->
<script src="lib/katavorio-0.6.js"></script>
<!-- jsplumb util -->
<script src="src/util.js"></script>
<script src="src/browser-util.js"></script>
<!-- base DOM adapter -->
<script src="src/dom-adapter.js"></script>
<!-- main jsplumb engine -->
<script src="src/jsPlumb.js"></script>
<script src="src/overlay-component.js"></script>
<!-- endpoint -->
<script src="src/endpoint.js"></script>
<!-- connection -->
<script src="src/connection.js"></script>
<!-- anchors -->
<script src="src/anchors.js"></script>
<!-- connectors, endpoint and overlays  -->
<script src="src/defaults.js"></script>
<!-- bezier connectors -->
<script src="src/connectors-bezier.js"></script>
<!-- state machine connectors -->
<script src="src/connectors-statemachine.js"></script>
<!-- flowchart connectors -->
<script src="src/connectors-flowchart.js"></script>
<script src="src/connector-editors.js"></script>
<!-- SVG renderer -->
<script src="src/renderers-svg.js"></script>
<!-- vml renderer -->
<script src="src/renderers-vml.js"></script>
<!-- no library jsPlumb adapter -->
<script src="src/base-library-adapter.js"></script>
<script src="src/dom.jsPlumb.js"></script>

<script src="js/deleteCookie.js" type="text/javascript"></script>
<script type="text/javascript">

    var name = "#floatMenu";
    var menuYloc = null;
    $(document).ready(function() {

        menuYloc = parseInt($(name).css("top").substring(0, $(name).css("top").indexOf("px")))
        $(window).scroll(function() {
            offset = menuYloc + $(document).scrollTop() + "px";
            $(name).animate({ top: offset }, { duration: 500, queue: false });
        });

        $.get("php/CheckWaitingSlice.php",
                function (data){
                    $("#CheckWaitingTbody").html(data);
                    $(".btnCheck").click(function(){
                        var value=$(this).attr("name");

                        //alert(value);
                        $.post("php/deleteOrder.php",
                                {
                                    OrderID:value
                                },function(data){
                                    if(data == "Success")
                                    {
                                        alert("Delete success");
                                        $("#"+value).remove();
                                    }
                                    else
                                    {
                                        alert("Delete failure");
                                    }
                                });
                    });
                });
        $.get("php/CheckRunningSlice.php",
                function(data)
                {
                    $("#CheckRunningTbody").html(data);
                    $(".btnTopology").click(function(){
                        $("#myModal").css("display","block");
                        var value=$(this).attr("name");
//                        alert(value);
                        $.post("php/ShowTopology.php",
                                {
                                    SliceID:value
                                },function(data){
                                    $("#flowchart-demo").empty();
                                   var content =   eval('(' + data + ')');
                                   var topology = content.Topology;
                                   // alert(topology);
                                    var SwitchNum = content.SwitchNum;
                                    var VMNum = content.VMNum;
                                    for (var i = 0; i < SwitchNum; i++) {
                                        var Switch = "<div class='window switch' id='s" + i + "' ><strong>s" + i + "</strong></div>";
                                        $("#flowchart-demo").append(Switch);
                                        var space = (800-60*SwitchNum)/(SwitchNum+1);
                                        var sID = "#s"+i ;
                                        var left = 60*i+(i+1)*space;
                                        $(sID).css("left", left );
                                    }
                                    for (var j = 0; j < VMNum; j++) {
                                        var host = "<div class='window host' id='" + "h" + j + "'><strong>" + "v" + j + "</strong></div>";
                                        $("#flowchart-demo").append(host);
                                        space = (800-60*VMNum)/(VMNum+1);
                                        var hID = "#h"+j ;
                                        left = 60*j+(j+1)*space;
                                        $(hID).css("left", left );
                                    }
                                    jsPlumb.ready(function () {

                                        var instance = jsPlumb.getInstance({

                                            DragOptions: {cursor: 'pointer', zIndex: 2000},
                                            ConnectionOverlays: [],
                                            Container: "flowchart-demo"
                                        });

                                     //   instance.registerConnectionType("basic", basicType);


                                        var connectorHoverStyle = {
                                                    lineWidth: 4,
                                                    strokeStyle: "#216477",
                                                    outlineWidth: 2,
                                                    outlineColor: "white"
                                                },
                                                endpointHoverStyle = {
                                                    fillStyle: "#216477",
                                                    strokeStyle: "#216477"
                                                },

                                                firstEndpoint = {
                                                    endpoint: "Dot",
                                                    paintStyle: {
                                                        strokeStyle: "#000000",  // endpoint color
                                                        fillStyle: "transparent",
                                                        radius: 5,
                                                        lineWidth: 2
                                                    },

                                                    connector: ["StateMachine", {curviness: 20}],
                                                    connectorStyle: {
                                                        strokeStyle: "#5c96bc",
                                                        lineWidth: 2,
                                                        outlineColor: "transparent",
                                                        outlineWidth: 4
                                                    },
                                                    hoverPaintStyle: endpointHoverStyle,
                                                    connectorHoverStyle: connectorHoverStyle,
                                                    dragOptions: {},
                                                    overlays: [
                                                        ["Label", {
                                                            location: [0.5, 1.5],
                                                            label: "eth0",
                                                            cssClass: "endpointSourceLabel"
                                                        }]
                                                    ]
                                                },
                                                secondEndpoint = {
                                                    endpoint: "Dot",
                                                    paintStyle: {
                                                        strokeStyle: "#000000",  // endpoint color
                                                        fillStyle: "transparent",
                                                        radius: 5,
                                                        lineWidth: 2
                                                    },

                                                    connector: ["StateMachine", {curviness: 20}],
                                                    connectorStyle: {
                                                        strokeStyle: "#5c96bc",
                                                        lineWidth: 2,
                                                        outlineColor: "transparent",
                                                        outlineWidth: 4
                                                    },
                                                    hoverPaintStyle: endpointHoverStyle,
                                                    connectorHoverStyle: connectorHoverStyle,
                                                    dragOptions: {},
                                                    overlays: [
                                                        ["Label", {
                                                            location: [0.5, 1.5],
                                                            label: "eth1",
                                                            cssClass: "endpointSourceLabel"
                                                        }]
                                                    ]
                                                },
                                                thirdEndpoint = {
                                                    endpoint: "Dot",
                                                    paintStyle: {
                                                        strokeStyle: "#000000",  // endpoint color
                                                        fillStyle: "transparent",
                                                        radius: 5,
                                                        lineWidth: 2
                                                    },

                                                    connector: ["StateMachine", {curviness: 20}],
                                                    connectorStyle: {
                                                        strokeStyle: "#5c96bc",
                                                        lineWidth: 2,
                                                        outlineColor: "transparent",
                                                        outlineWidth: 4
                                                    },
                                                    hoverPaintStyle: endpointHoverStyle,
                                                    connectorHoverStyle: connectorHoverStyle,
                                                    dragOptions: {},
                                                    overlays: [
                                                        ["Label", {
                                                            location: [0.5, 1.5],
                                                            label: "eth2",
                                                            cssClass: "endpointSourceLabel"
                                                        }]
                                                    ]
                                                },
                                                fourthEndpoint = {
                                                    endpoint: "Dot",
                                                    paintStyle: {
                                                        strokeStyle: "#000000",  // endpoint color
                                                        fillStyle: "transparent",
                                                        radius: 5,
                                                        lineWidth: 2
                                                    },

                                                    connector: ["StateMachine", {curviness: 20}],
                                                    connectorStyle: {
                                                        strokeStyle: "#5c96bc",
                                                        lineWidth: 2,
                                                        outlineColor: "transparent",
                                                        outlineWidth: 4
                                                    },
                                                    hoverPaintStyle: endpointHoverStyle,
                                                    connectorHoverStyle: connectorHoverStyle,
                                                    dragOptions: {},
                                                    overlays: [
                                                        ["Label", {
                                                            location: [0.5, 1.5],
                                                            label: "eth3",
                                                            cssClass: "endpointSourceLabel"
                                                        }]
                                                    ]
                                                },

                                                init = function (connection) {
                                                    connection.getOverlay("label").setLabel(connection.sourceId.substring(15) + "-" + connection.targetId.substring(15));
                                                };
                                        var addSwitchEndpoints = function (toId, Anthors) {
                                            var Endpoints = [firstEndpoint, secondEndpoint, thirdEndpoint, fourthEndpoint];
                                            for (var i = 0; i < Anthors.length; i++) {
                                                var uuid = toId + ":" + i;
                                                instance.addEndpoint(toId, Endpoints[i], {
                                                    anchor: Anthors[i], uuid: uuid
                                                });
                                            }
                                        };
                                        var addVMEndpoints = function (toId, Anthors) {
                                            for (var j = 0; j < Anthors.length; j++) {
                                                var uuid = toId + ":" + j;
                                                instance.addEndpoint(toId, firstEndpoint, {
                                                    anchor: Anthors[j], uuid: uuid
                                                });
                                            }
                                        };


                                        instance.batch(function () {
                                            for (var i = 0; i < SwitchNum; i++) {
                                                var Switch = "s" + i;
                                                addSwitchEndpoints(Switch, ["TopCenter", "LeftMiddle", "BottomCenter", "RightMiddle"])
                                            }
                                            for (var j = 0; j < VMNum; j++) {
                                                var VM = "h" + j;
                                                addVMEndpoints(VM, ["TopCenter"])
                                            }



//                                            instance.bind("connection", function (connInfo, originalEvent) {
//                                                init(connInfo.connection);
//                                            });


                                            instance.draggable(jsPlumb.getSelector(".flowchart-demo .window"), {grid: [20, 20]});


//                                            instance.bind("click", function (c) {
//                                                instance.detach(c);
//                                            });


                                            instance.bind("connectionDrag", function (connection) {
                                                console.log("connection " + connection.id + " is being dragged. suspendedElement is ", connection.suspendedElement, " of type ", connection.suspendedElementType);
                                            });

                                            instance.bind("connectionDragStop", function (connection) {
                                                console.log("connection " + connection.id + " was dragged");
                                            });

                                            instance.bind("connectionMoved", function (params) {
                                                console.log("connection " + params.connection.id + " was moved");
                                            });
                                            for  (  var strObjIndex in  topology)
                                            {
                                                instance.connect({uuids: [strObjIndex, topology[strObjIndex]], editable: false});
                                            }


                                        });

                                   //     jsPlumb.fire("jsPlumbDemoLoaded", instance);

                                    });
                                    $('#myModal').modal('toggle');
                                });



                    });

                });




    });

</script>
</body>
</html>